<p><link rel='stylesheet' href='../../assets/css/main.css'/></p>
<p><a href="../../README.html">&lt;&lt; back to main index</a></p>
<h1 id="kmeans-lab">KMeans Lab</h1>
<p>In this lab we discuss how to use kmeans clustering in Spark.</p>
<h2 id="step-1-examine-the-mtcars-dataset">Step 1: Examine the MTCars dataset</h2>
<p>Check out the dataset that we are going to cluster: MTCars. Those of you with experience in R should remember this as one of R’s internal datasets.</p>
<p>This dataset contains some statistics on 1974 Cars from Motor Trends</p>
<p><img src="../../assets/images/6.1-cars2.png" style="border: 5px solid grey; max-width:100%;" /></p>
<p>You can also download and view the raw data in Excel : <a href="/data/cars/mtcars_header.csv">cars.csv</a></p>
<p>Here are the columns that we are going to use: * name - name of the car * mpg - Miles/(US) gallon<br />
* cyl - Number of cylinders<br />
* disp - Displacement (cu.in.)<br />
* hp - Gross horsepower<br />
* drat - Rear axle ratio</p>
<p>Are there any natural clusters you can identify from this data?</p>
<p>We are going to use <strong>MPG and CYL</strong> attributes to cluster.</p>
<h2 id="step-2-inspect-the-script">Step 2: Inspect the script</h2>
<p>Open file <a href="kmeans_mtcars.scala" class="uri">kmeans_mtcars.scala</a> and examine it.<br />
This script has some <em>TODO</em> items in it.<br />
We are going to fix these TODO items and run the script <strong>line-by-line</strong> in Spark Shell to understand what is going on.</p>
<h2 id="step-3-launch-spark-shell">Step 3 : Launch Spark Shell</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1">    <span class="co"># start shell</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">    $  <span class="ex">~/spark/bin/spark-shell</span></a></code></pre></div>
<h3 id="download-the-spreadsheet">Download the <a href="WSSSE-versus-k.xlsx">spreadsheet</a></h3>
<p><strong>=&gt; Open the script <code>kmeans_mtcars.scala</code> in a favorite editor.</strong></p>
<p><strong>=&gt; Copy paste snippets from text editor into Spark shell. Watch the execution and the results</strong></p>
<p><strong>==&gt; And record the K vs. WSSE values in the provided WSSSE-versus-k.xlsx.</strong></p>
<p><strong>=&gt; Also keep an eye on Spark web UI (4040)</strong></p>
<p><strong>=&gt; We will plot K vs. WSSSE as follows</strong></p>
<p><img src="../../assets/images/6.1-wssse-vs-k.png" style="border: 5px solid grey; max-width:100%;" /></p>
<p><strong>=&gt; set K=32 and compute WSSSE can you explain?</strong></p>
<h2 id="step-4-run-the-whole-script">Step 4: Run the whole script</h2>
<p>Once you fix TODO items in the script, we can run the entire script as follows</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1">    <span class="co"># supply the file to run with -i flag</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    $ <span class="ex">~/spark/bin/spark-shell</span> -i ~/spark-labs/06-mllib/kmeans/kmeans_mtcars.scala</a></code></pre></div>
<p><strong>Hint</strong> You can also load a file into scala shell Using</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb3-1" data-line-number="1">    :load file_name.<span class="fu">scala</span></a></code></pre></div>
<h2 id="bonus-1-optimize-script">Bonus 1 : Optimize Script</h2>
<p>Can we cache the data to speed up computations?<br />
Try this</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb4-1" data-line-number="1">    dataset.<span class="fu">cache</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">    dataset.<span class="fu">count</span></a></code></pre></div>
<h2 id="bonus-2-adding-your-own-cars">Bonus 2 : Adding your own cars</h2>
<p>Edit input data file <code>/data/cars/mtcars.csv</code>.<br />
Add some new rows to the mtcars dataset based on your favorite cars (or just make up some fictitious cars).</p>
<p>Then run the script again.</p>
<pre><code>$ time  ~/spark/bin/spark-shell -i kmeans_mtcars.scala  2&gt; logs</code></pre>
<p>See how adding this affects the way the data is clustered?</p>
