<p><link rel='stylesheet' href='../../assets/css/main.css'/></p>
<p><a href="../../README.html">&lt;&lt; back to main index</a></p>
<h1 id="lab-8.2---spark-streaming-windowed-calculations">Lab 8.2 - Spark Streaming Windowed Calculations</h1>
<h3 id="overview">Overview</h3>
<p>Submit a job for Spark Streaming and doing ‘windowed count’</p>
<h3 id="depends-on">Depends On</h3>
<p>None</p>
<h3 id="run-time">Run time</h3>
<p>30-40 mins</p>
<h2 id="step-1-run-netcat-server">STEP 1: Run Netcat Server</h2>
<p>Use <code>nc</code> command to move text you type to port 9999 Open an terminal and run this command at prompt</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1">    $ <span class="ex">nc</span> -lk 9999</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="co"># if this gives an error like &#39;Protocol not available&#39; use this</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">    <span class="co"># $  ~/bin/nc  -lk 9999</span></a></code></pre></div>
<h2 id="step-2-run-the-python-file">STEP 2: Run the python file</h2>
<p>Go to the project root directory</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1">    $   <span class="bu">cd</span> ~/spark-labs/08-streaming/8.2-window</a></code></pre></div>
<p>Run the python file <strong>python/windowed_count.py</strong> using spark submit command</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1">    $   <span class="ex">~/spark/bin/spark-submit</span>  --master local[2]   --driver-class-path logging/  python/windowed_count.py</a></code></pre></div>
<h2 id="step-3-feed-some-data-into-netcat-window">STEP 3: Feed some data into netcat window</h2>
<p><strong>=&gt; Try typing / pasting the following text in netcat</strong></p>
<pre><code>1420070400000,ip_1,user_5,clicked,facebook.com,campaign_6,139,session_98
1420070400864,ip_2,user_3,viewed,facebook.com,campaign_4,35,session_98
1420070401728,ip_8,user_8,clicked,youtube.com,campaign_12,115,session_92
1420070402592,ip_1,user_2,blocked,wikipedia.org,campaign_5,129,session_91
1420070403456,ip_7,user_7,viewed,funnyordie.com,campaign_11,12,session_13
1420070404320,ip_9,user_5,clicked,foxnews.com,campaign_2,173,session_24</code></pre>
<p><strong>=&gt; Notice the kafka streaming console</strong></p>
<pre class="console"><code>-------------------------------------------
Time: 2019-07-22 13:18:30
-------------------------------------------
(u&#39;clicked&#39;, 1)
(u&#39;viewed&#39;, 1)
(u&#39;clicked&#39;, 1)
(u&#39;blocked&#39;, 1)
(u&#39;viewed&#39;, 1)
(u&#39;blocked&#39;, 1)</code></pre>
<h2 id="step-4-enable-window-count">STEP 4: Enable Window Count</h2>
<ul>
<li>Edit the file python/windowed_count.py</li>
<li>Run using the spark-submit command</li>
</ul>
<p>** ==&gt; fix TODO-1 to enable Window count<strong> </strong> ==&gt; save and run the file**</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1">    $    <span class="ex">~/spark/bin/spark-submit</span>  --master local[2]   --driver-class-path logging/  python/windowed_count.py</a></code></pre></div>
<p><strong>=&gt; Paste some logs in netcat window</strong></p>
<p><strong>=&gt; Hit Ctrl+C in netcat terminal to terminate Spark streaming</strong></p>
<p><strong>=&gt; Inspect some files, what do you see?</strong></p>
<p>Test with following lines</p>
<pre><code>1420070400000,ip_1,user_5,clicked,facebook.com,campaign_6,139,session_98
1420070400864,ip_2,user_3,viewed,facebook.com,campaign_4,35,session_98
1420070401728,ip_8,user_8,clicked,youtube.com,campaign_12,115,session_92
1420070402592,ip_1,user_2,blocked,wikipedia.org,campaign_5,129,session_91
1420070403456,ip_7,user_7,viewed,funnyordie.com,campaign_11,12,session_13
1420070404320,ip_9,user_5,clicked,foxnews.com,campaign_2,173,session_24</code></pre>
